<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jaces Games - 50 Games</title>
    <link rel="icon" type="image/png" href="icon.png"> 
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Rubik:wght@700&display=swap" rel="stylesheet">
    <style>
        /* === CUSTOM FONT DEFINITION === */
        @font-face {
            font-family: 'SuperJoyful';
            src: url('SuperJoyful-lxwPq.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }

        /* * === FILTER-RESISTANT BASE STYLES === */
        body {
            font-family: 'SuperJoyful', 'Inter', sans-serif !important;
            background-color: #0f172a !important;
            min-height: 100vh !important;
            padding: 0.5rem 1rem 2rem 1rem !important; 
            position: relative !important;
            line-height: 1.5 !important; 
        }
        
        /* Version Tag: Forced Position */
        .version-tag {
            position: absolute !important;
            top: 0.25rem !important;
            right: 0.75rem !important;
            color: rgba(226, 232, 240, 0.5) !important;
            font-size: 0.875rem !important;
            font-weight: 500 !important;
        }

        /* Main Container: Force Layout and Dark Mode */
        .main-container {
            width: 100% !important;
            max-width: 1152px !important;
            margin-left: auto !important;
            margin-right: auto !important;
            text-align: center !important;
            padding: 1rem 2.5rem 2.5rem 2.5rem !important; /* Top padding is 1rem */
            background-color: #1e293b !important; 
            color: #e2e8f0 !important; 
            border-radius: 1.5rem !important; 
            border: 1px solid #334155 !important; 
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5), 
                        0 8px 10px -6px rgba(0, 0, 0, 0.5) !important;
        }
        
        /* Header and Subtitle Margins */
        h1 {
            margin-top: 0 !important; 
            font-size: 3rem !important; 
            font-weight: 800 !important; 
            
            /* CRITICAL FIX: Drastically reduced bottom margin (was 0.25rem) */
            margin-bottom: 0 !important; 
        }
        #dynamic-subtitle {
            /* CRITICAL FIX: Removed margin-top (default is 0), significantly reduced margin-bottom (was 2rem) */
            margin-top: 0.5rem !important; /* Add small space below title */
            margin-bottom: 1.5rem !important; /* Reduced space above the game grid (was mb-8) */
            
            font-size: 1.5rem !important; 
            font-weight: 600 !important; 
            animation: color-cycle 10s infinite alternate !important; 
        }

        /* Grid Layout */
        .game-grid {
            display: grid !important;
            grid-template-columns: repeat(2, minmax(0, 1fr)) !important; 
            gap: 1.5rem !important;
        }
        @media (min-width: 640px) {
            .game-grid {
                grid-template-columns: repeat(3, minmax(0, 1fr)) !important;
                gap: 2rem !important;
            }
        }
        @media (min-width: 1024px) { 
            .game-grid {
                grid-template-columns: repeat(4, minmax(0, 1fr)) !important;
            }
        }
        
        /* Game Card Styles */
        .link-card {
            display: block !important;
            transition: transform 0.3s ease !important;
            border-radius: 0.75rem !important;
        }
        .link-card:hover {
            transform: scale(1.05) !important;
        }
        .link-card img {
            width: 100% !important;
            height: auto !important;
            aspect-ratio: 1 / 1 !important;
            object-fit: cover !important;
            border-radius: 0.75rem !important;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.3) !important;
            border: 4px solid #334155 !important;
            transition: all 0.3s ease !important;
        }
        .group:hover .link-card img {
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5), 0 0 15px rgba(52, 211, 153, 0.5) !important; 
        }
        
        /* Game Name Styles */
        .item-name {
            font-size: 1.4rem !important; 
            font-weight: 600 !important; 
            margin-top: 0.75rem !important;
            color: #e5e5e5 !important; 
            transition: color 0.2s ease !important;
        }
        .group:hover .item-name {
            color: #34d399 !important; 
        }

        /* Footer Text Styles */
        .footer-note {
            margin-top: 2rem !important; 
            font-size: 0.875rem !important; 
            color: #9ca3af !important; 
        }
        .glowing-red {
            margin-top: 0.5rem !important; 
            color: #ff3333 !important; 
            animation: glowing-red 1.5s infinite alternate !important;
            font-weight: bold !important;
            font-size: 0.875rem !important;
        }
        
        /* Scrollbar and Animation Keyframes (No Change) */
        body::-webkit-scrollbar { width: 12px; }
        body::-webkit-scrollbar-track { background: #0f172a; }
        body::-webkit-scrollbar-thumb { background-color: #334155; border-radius: 20px; border: 3px solid #0f172a; }
        body::-webkit-scrollbar-thumb:hover { background-color: #475569; }

        .animated-title {
            background: linear-gradient(90deg, #60a5fa, #facc15, #ef4444, #8b5cf6, #34d399);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradient-shift 4s linear infinite;
        }
        @keyframes gradient-shift {
            to { background-position: -200% center; }
        }

        #dynamic-subtitle {
            opacity: 1;
            transition: opacity 1s ease-in-out;
        }
        #dynamic-subtitle.fade-out {
            opacity: 0;
        }
        @keyframes color-cycle {
            0%   { color: #8b5cf6; } 25%  { color: #34d399; } 50%  { color: #facc15; } 75%  { color: #f87171; } 100% { color: #8b5cf6; }
        }
        @keyframes glowing-red {
            0% { text-shadow: 0 0 5px rgba(255, 0, 0, 0.5), 0 0 10px rgba(255, 0, 0, 0.4); }
            50% { text-shadow: 0 0 10px #ff0000, 0 0 20px #ff0000, 0 0 30px rgba(255, 0, 0, 0.8); }
            100% { text-shadow: 0 0 5px rgba(255, 0, 0, 0.5), 0 0 10px rgba(255, 0, 0, 0.4); }
        }
        
        /* === UPDATE LOG MODAL STYLES === */
        .modal-overlay {
            display: none; /* Hidden by default */
            position: fixed;
            z-index: 1000; 
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            align-items: center; 
            justify-content: center;
            background-color: rgba(0,0,0,0.8); 
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            /* Ensure the overlay itself is not visible during the fade-out */
            transition: background-color 0.5s; 
        }

        .modal-content {
            background-color: #1e293b;
            color: #e2e8f0;
            margin: 20px auto; 
            padding: 25px;
            border: 1px solid #334155;
            border-radius: 1rem;
            width: 90%; 
            max-width: 500px;
            max-height: 90vh; 
            overflow-y: auto;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.6);
            /* Initial animation for showing the modal */
            animation: fadeIn 0.5s forwards; 
            /* Set transition properties for smooth animation */
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }

        /* NEW: Fade out class applied by JavaScript */
        .modal-content.fade-out {
            animation: fadeOut 0.5s forwards; 
        }

        .modal-content h2 {
            color: #34d399;
            font-size: 2rem;
            margin-top: 0;
            margin-bottom: 1rem;
            padding-right: 30px; 
        }
        
        .modal-content ul {
            list-style: none;
            padding: 0;
            text-align: left;
            margin-bottom: 1.5rem;
        }

        .modal-content ul li {
            background: #0f172a;
            padding: 10px;
            margin-bottom: 8px;
            border-left: 4px solid #60a5fa;
            border-radius: 0.5rem;
            font-size: 1rem;
        }
        
        .close-container {
            position: absolute; 
            top: 15px;
            right: 15px;
        }
        
        .close-button {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            line-height: 20px;
            transition: color 0.2s;
            display: block;
        }

        .close-button:hover,
        .close-button:focus {
            color: #ff3333;
            text-decoration: none;
            cursor: pointer;
        }
        
        /* Keyframes for animation */
        @keyframes fadeIn {
            from {opacity: 0; transform: translateY(-20px);}
            to {opacity: 1; transform: translateY(0);}
        }
        
        @keyframes fadeOut {
            from {opacity: 1; transform: translateY(0);}
            to {opacity: 0; transform: translateY(-20px);} /* Slides up slightly as it fades */
        }
    </style>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2038218004781592"
     crossorigin="anonymous"></script>
</head>
<body class="relative"> 
    
    <div id="updateLogModal" class="modal-overlay">
        <div id="modalContent" class="modal-content" style="position: relative;"> 
            <div class="close-container">
                <span class="close-button" onclick="closeModal()">X</span>
            </div>
            <h2>ðŸ”¥ Update Log - v1.1.3</h2>
            <ul>
                <li>ðŸ”Š **Background Music!** Added smooth background music to the page.</li>
                <li>âœ¨ **Fading Effect:** Music now **fades out** when you leave the tab and **fades in** when you return, instead of instantly stopping.</li>
                <li>ðŸš€ **New Games!** Added 10 exciting new games, bringing the total count up to **50**! (Inherited from 1.1.2)</li>
            </ul>
            <p style="font-size: 0.9rem; color: #9ca3af;">
                *This pop-up will not appear again unless you clear your browser's local storage.*
            </p>
        </div>
    </div>
    <audio id="background-music" loop>
        <source src="music.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <div class="version-tag">
        v1.1.3
    </div>

    <div class="main-container">
        <h1 class="animated-title">
            Jaces Unblocked Games
        </h1>
        
        <p id="dynamic-subtitle">
            </p>

        <div class="game-grid">

            <script>
                /**
                 * Opens a new window with the URL 'about:blank' and loads the game 
                 * inside a full-screen iframe to preserve the 'about:blank' address bar content.
                 * @param {string} link - The actual URL of the game file.
                 * @param {string} name - The title of the game.
                 */
                function openGame(link, name) {
                    // 1. Open a new, clean window with 'about:blank'
                    const newWindow = window.open('about:blank', '_blank');

                    if (newWindow) {
                        try {
                            // 2. Construct the full HTML content with an iframe
                            const content = `
                                <!DOCTYPE html>
                                <html lang="en">
                                <head>
                                    <meta charset="UTF-8">
                                    <title>${name}</title>
                                    <style>
                                        /* Make sure the iframe fills the entire window */
                                        html, body { margin: 0; padding: 0; overflow: hidden; height: 100%; width: 100%; background: #000; }
                                        #game-frame { 
                                            border: none; 
                                            width: 100vw; 
                                            height: 100vh; 
                                            display: block; 
                                        }
                                    </style>
                                </head>
                                <body>
                                    <iframe id="game-frame" src="${link}" allowfullscreen></iframe>
                                </body>
                                </html>
                            `;
                            
                            // 3. Write the content directly into the new window's document
                            newWindow.document.write(content);
                            // 4. Close the document write stream (critical for rendering)
                            newWindow.document.close();

                        } catch (e) {
                            console.error("Failed to inject iframe content into about:blank, falling back to redirection:", e);
                            // Fallback to simple redirection if the write process fails
                            newWindow.location.href = link;
                        }
                    } else {
                        // If the pop-up was blocked
                        console.error('Pop-up blocked. Opening game link directly.');
                        window.open(link, '_blank');
                    }
                }
                
                // Updated: createGameCard uses the openGame function in the onclick handler
                function createGameCard(link, imageSrc, name, placeholder = false) {
                    const fallbackImg = "icons/fallback-placeholder.png"; 
                    // Escape single quotes in the name for JavaScript function call
                    const escapedName = name.replace(/'/g, "\\'"); 
                    
                    const gameHtml = `
                    <div class="group">
                        <a 
                            href="javascript:void(0)" 
                            onclick="openGame('${link}', '${escapedName}')"
                            class="link-card" 
                            aria-label="Click to play ${name}"
                        >
                            <img 
                                src="${imageSrc}" 
                                alt="Icon for ${name} game" 
                                onerror="this.onerror=null; this.src='${fallbackImg}';"
                            >
                        </a>
                        <p class="item-name ${placeholder ? 'text-red-400 italic' : ''}">
                            ${name} ${placeholder ? ' (Placeholder)' : ''}
                        </p>
                    </div>
                    `;
                    document.write(gameHtml);
                }
            </script>

            <script>createGameCard('./games/3D Geometry Dash.html', 'icons/3D Geometry Dash.jpg', '3D Geometry Dash');</script>
            <script>createGameCard('./games/99 Nights in the Forest.html', 'icons/99 nights.webp', '99 Nights');</script>
            <script>createGameCard('./games/99% will lose.html', 'icons/99 percent will fail.webp', '99% Will Fail');</script>
            <script>createGameCard('./games/Aquapark Idle.html', 'icons/Aquapark Idle.png', 'Aquapark Idle');</script>
            <script>createGameCard('./games/Baldis Basics Camping.html', 'icons/baldis camping.jpg', 'Baldis Basics Camping');</script>
            <script>createGameCard('./games/Bank Breakout 2.html', 'icons/Bank Breakout 2.webp', 'Bank Breakout 2');</script>
            <script>createGameCard('./games/Basket Random.html', 'icons/Basket Random.jpg', 'Basket Random');</script>
            <script>createGameCard('./games/BitLife.html', 'icons/BitLife.png', 'BitLife');</script>
            <script>createGameCard('./games/Chicken Battle.html', 'icons/battle chicken.webp', 'Chicken Battle');</script>
            <script>createGameCard('./games/Cookie Clicker.html', 'icons/cookie clicker.png', 'Cookie Clicker');</script>
            <script>createGameCard('./games/Death Run.html', 'icons/Death Run.jpg', 'Death Run');</script>
            <script>createGameCard('./games/Drift Boss.html', 'icons/Drift Boss.jpg', 'Drift Boss');</script>
            <script>createGameCard('./games/Drive Mad.html', 'icons/Drive Mad.jpg', 'Drive Mad');</script>
            <script>createGameCard('./games/Duck Duck Clicker.html', 'icons/duck duck clicker.png', 'Duck Duck Clicker');</script>
            <script>createGameCard('./games/Elytra Coming.html', 'icons/elytras coming.jpg', 'Elytras Coming');</script>
            <script>createGameCard('./games/Five Nights At Freddys Free Roam.html', 'icons/fnaf3d.png', 'FNAF 3D');</script>
            <script>createGameCard('./games/Funny Ragdoll Wrestlers.html', 'icons/Funny Ragdoll Wrestlers.png', 'Funny Ragdoll Wrestlers');</script>
            <script>createGameCard('./games/Geometry Dash Wave Challenge.html', 'icons/gd wave.png', 'Geometry Dash Wave');</script>
            <script>createGameCard('./games/Granny.html', 'icons/granny.png', 'Granny');</script>
            <script>createGameCard('./games/Granny 2.html', 'icons/granny 2.png', 'Granny 2');</script>
            <script>createGameCard('./games/Granny 3.html', 'icons/Granny 3.png', 'Granny 3');</script>
            <script>createGameCard('./games/Granny Multiplayer.html', 'icons/granny multiplayer.png', 'Granny Multiplayer');</script>
            <script>createGameCard('./games/Gunspin.html', 'icons/gunspin.webp', 'Gunspin');</script>
            <script>createGameCard('./games/Hanger.html', 'icons/Hanger.jpeg', 'Hanger');</script>
            <script>createGameCard('./games/Kart Bros.io.html', 'icons/kart bros.jpg', 'Kart Bros.io');</script>
            <script>createGameCard('./games/Lemon Clicker.html', 'icons/Lemon Clicker.png', 'Lemon Clicker');</script>
            <script>createGameCard('./games/Mega Mart Tycoon.html', 'icons/Mega Mart Tycoon.webp', 'Mega Mart Tycoon');</script>
            <script>createGameCard('./games/Minecraft v1.8.8.html', 'icons/1 8 8 icon.jpg', 'Minecraft 1.8.8');</script>
            <script>createGameCard('./games/Noob vs Pro.html', 'icons/Noob vs Pro.png', 'Noob vs Pro');</script>
            <script>createGameCard('./games/OvO.html', 'icons/ovo.png', 'OVO');</script>
            <script>createGameCard('./games/Paint Map Simulator.html', 'icons/Paint Map Simulator.avif', 'Paint Map Simulator');</script>
            <script>createGameCard('./games/Paper.io 2.html', 'icons/paper io 2.png', 'Paper.io 2');</script>
            <script>createGameCard('./games/Pizza Clicker.html', 'icons/Pizza Clicker.png', 'Pizza Clicker');</script>
            <script>createGameCard('./games/Poly Track.html', 'icons/Poly Track.avif', 'Poly Track');</script>
            <script>createGameCard('./games/Racing Jump.html', 'icons/Racing Jump.png', 'Racing Jump');</script>
            <script>createGameCard('./games/Robby Blocks.html', 'icons/Robby Blocks.webp', 'Robby Blocks');</script>
            <script>createGameCard('./games/Rocket Soccer Derby.html', 'icons/Rocket Soccer Derby.png', 'Rocket Soccer Derby');</script>
            <script>createGameCard('./games/Slither v2.html', 'icons/slither io.webp', 'Slither.io');</script>
            <script>createGameCard('./games/Snow Rider 3d.html', 'icons/snow rider 3d.png', 'Snow Rider 3D');</script>
            <script>createGameCard('./games/Snowboard Obby.html', 'icons/snowboard obby.png', 'Snowboard Obby');</script>
            <script>createGameCard('./games/Snowball.io.html', 'icons/Snowball.io.png', 'Snowball.io');</script>
            <script>createGameCard('./games/Soccer But You Are A Car.html', 'icons/soccer battle.webp', 'Soccer But You Are A Car');</script>
            <script>createGameCard('./games/Soccer Random.html', 'icons/Soccer Random.png', 'Soccer Random');</script>
            <script>createGameCard('./games/Spacebar Clicker.html', 'icons/Spacebar Clicker.png', 'Spacebar Clicker');</script>
            <script>createGameCard('./games/Steal A Brainrot.html', 'icons/steal a brainrot.webp', 'Steal A Brainrot');</script>
            <script>createGameCard('./games/Survival Race.html', 'icons/survival race.webp', 'Survival Race');</script>
            <script>createGameCard('./games/They Are Coming.html', 'icons/they are coming.webp', 'They Are Coming');</script>
            <script>createGameCard('./games/Ultimate Car Driving Game.html', 'icons/Ultimate Car Driving Game.png', 'Ultimate Car Driving Game');</script>
            <script>createGameCard('./games/Ultrakill.html', 'icons/ultrakill.png', 'Ultrakill');</script>
            <script>createGameCard('./games/Wordle Unlimited.html', 'icons/Wordle Unlimited.jpeg', 'Wordle Unlimited');</script>
        </div>
        
        <p class="footer-note">
            Note: All **50** games are currently available! Enjoy playing!
        </p>
        
        <p class="glowing-red">
            Some Games Depend On Your Browser or Device and May Not Work.
        </p>
        
        <p style="margin-top: 1rem; font-size: 0.875rem; color: #9ca3af; text-align: center;">
            &copy; 2025 Jace's Games
        </p>

    </div>

    <script>
        // --- UPDATE LOG LOGIC (v1.1.3) ---
        const modal = document.getElementById('updateLogModal');
        const modalContent = document.getElementById('modalContent');
        // UPDATED: Changed storage key to be version-specific (v1.1.3)
        const storageKey = 'updateLogShown_v1.1.3'; 
        const fadeDuration = 500; // 0.5 seconds, matching the CSS transition

        function closeModal() {
            // 1. Set flag in localStorage so it doesn't show again
            localStorage.setItem(storageKey, 'true');
            
            // 2. Start the fade-out animation on the content
            modalContent.classList.add('fade-out');
            
            // 3. Hide the entire modal after the animation finishes
            setTimeout(() => {
                modal.style.display = 'none';
                // Clean up the class so it's ready for the next time (if storage is cleared)
                modalContent.classList.remove('fade-out'); 
            }, fadeDuration); 
        }

        // Show the modal if the flag is NOT set in localStorage
        if (localStorage.getItem(storageKey) !== 'true') {
            modal.style.display = 'flex'; 
            
            // Allow clicking outside the modal to close it (and set the flag)
            window.onclick = function(event) {
                if (event.target === modal) {
                    closeModal();
                }
            }
        }
        
        // --- Dynamic Subtitle Logic (Existing) ---
        const subtitleElement = document.getElementById('dynamic-subtitle');
        const phrases = [
            // Updated to reflect 50 games
            "Now featuring all 50 available games! Click on an image to play.",
            "Your source for unblocked games and endless fun.",
            "50 games and counting! Find your next favorite.",
            "Play anywhere, anytime. All games are unblocked.",
            // New Phrase
            "Try the new games: Drift Boss, Drive Mad, and Wordle Unlimited!",
            "Psst... you should probably click on Cookie Clicker. Just saying.", 
            "Your internet history is safe with us... probably.", 
            "Warning: May cause extreme fun. Proceed with caution!", 
            "Boredom is a lie. Play these instead of doing your homework.", 
            "Don't worry, these games are school-approved... by us!", 
            "My therapist told me to embrace my inner child. So I played Ultrakill.", 
            "Check out our full list, from FNAF to Minecraft!", 
            "Proof that procrastination can be productive. Sort of.", 
            "New games are added regularly, so check back soon!", 
            "Shhh! Don't tell your IT admin we're here.", 
            "Did you know Paper.io 2 is a classic? Give it a try!", 
            "We've optimized this site for maximum fun and minimal attention span.", 
            "Escape the boredom with games like Granny and Baldis Basics!",
            "Remember to blink. And maybe stretch.", 
            "Need a quick break? Snow Rider 3D is waiting.",
            "If you get caught, blame the guy who coded the flashing title.", 
            "Challenge your reflexes with Geometry Dash Wave.",
            "Warning: May cause intense focus on non-school-related activities.", 
            "We've got the classics and the new hitsâ€”all unblocked.",
            "Why study when you can click a cookie 10,000 times?", 
            "Unleash your inner gamer. Explore the collection!",
            "Find fun in every click. Start playing now!",
            "From simple clickers to intense survivalâ€”we have it all.",
            // Updated to reflect 50 games
            "Explore 50 different worlds right here.",
            "No downloads, just instant gaming fun!",
            "Having a bad day? A little Ultrakill might help.",
            "Don't forget to check out Chicken Battle!",
            "Is the principal watching? Good. Play anyway.",
            "Your favorite games, 100% unblocked and ready.",
            "Feeling competitive? Try Kart Bros.io or Rocket Soccer Derby!",
            "The best way to spend a few minutes (or hours).",
            "Get ready for some classic Slither.io action.",
            "Which game will you master first?",
            "Click on the icon to start your adventure!",
            "Fresh games and classic thrills are waiting for you.",
            "We make sure the fun is never blocked. Enjoy!",
            "Need a boost? Try Ultimate Car Driving Game!",
            "Drifting is mandatory. Try Drift Boss now!",
            "Drive Mad is harder than it looks. Good luck!",
        ];
        let currentIndex = -1; 
        const intervalTime = 10000; 
        const fadeDurationSubtitle = 1000; 

        function getNextRandomIndex(current) {
            let newIndex;
            do {
                newIndex = Math.floor(Math.random() * phrases.length);
            } while (newIndex === current); 
            return newIndex;
        }

        function updateSubtitle() {
            subtitleElement.classList.add('fade-out');

            setTimeout(() => {
                currentIndex = getNextRandomIndex(currentIndex);
                const text = phrases[currentIndex];
                
                subtitleElement.textContent = text;
                
                subtitleElement.classList.remove('fade-out');
            }, fadeDurationSubtitle); 
        }

        currentIndex = getNextRandomIndex(currentIndex);
        subtitleElement.textContent = phrases[currentIndex];

        setInterval(updateSubtitle, intervalTime);

        // --- MUSIC CONTROL LOGIC (Existing) ---
        const music = document.getElementById('background-music');
        let played = false;

        // Function to attempt playing on first interaction
        function playOnFirstInteraction() {
            if (!played) {
                // Use .then() to handle Promise for modern browser play() method
                music.play().then(() => {
                    played = true;
                    // Remove listeners once playback is successfully initiated
                    document.removeEventListener('click', playOnFirstInteraction);
                    document.removeEventListener('scroll', playOnFirstInteraction);
                }).catch(error => {
                    // console.log("Autoplay blocked, waiting for more interaction.", error);
                    // Keep listeners active if blocked
                });
            }
        }

        // Attach listeners for interaction
        document.addEventListener('click', playOnFirstInteraction);
        document.addEventListener('scroll', playOnFirstInteraction);


        // --- PAUSE/PLAY WHEN TAB CHANGES (UPDATED FOR FADING) ---
        let isPlaying = false; // Tracks if the music was actively playing when the tab lost focus
        let fadeInterval = null;
        const FADE_TIME_MS = 1000; // Total time for fade effect (1 second)
        
        /**
         * Gradually changes the volume of the audio element.
         * @param {number} targetVolume - The final volume (0.0 to 1.0).
         * @param {number} durationMs - The total time the fade should take.
         * @param {function} onComplete - Callback function to run when the fade finishes.
         */
        function startFade(targetVolume, durationMs, onComplete) {
            // Clear any existing interval
            if (fadeInterval) {
                clearInterval(fadeInterval);
                fadeInterval = null;
            }

            const startVolume = music.volume;
            // Use 50 steps for a smooth 1000ms fade (20ms interval)
            const steps = 50; 
            const volumeChangePerStep = (targetVolume - startVolume) / steps;
            const intervalTime = durationMs / steps;

            fadeInterval = setInterval(() => {
                let currentVolume = music.volume;
                let newVolume = currentVolume + volumeChangePerStep;

                // Clamp the new volume between 0 and 1
                newVolume = Math.min(1, Math.max(0, newVolume));

                music.volume = newVolume;

                // Check if the fade is complete
                // Use a small epsilon (e.g., 0.001) for float comparisons
                if ((volumeChangePerStep > 0 && newVolume >= targetVolume - 0.001) || 
                    (volumeChangePerStep < 0 && newVolume <= targetVolume + 0.001)) {
                    
                    music.volume = targetVolume; // Ensure it hits the exact target volume
                    clearInterval(fadeInterval);
                    fadeInterval = null;
                    if (onComplete) {
                        onComplete();
                    }
                }
            }, intervalTime);
        }

        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                // If the document is hidden (user switched tabs)
                if (!music.paused) {
                    isPlaying = true; // Remember it was playing
                    
                    // Start Fade Out (volume to 0.0)
                    startFade(0, FADE_TIME_MS, () => {
                        music.pause();
                        // Reset volume to 1.0 so the next fade-in starts correctly
                        music.volume = 1.0; 
                    });
                } else {
                    isPlaying = false;
                }
            } else {
                // If the document is visible (user switched back)
                // Only try to play if it was playing when the tab was hidden AND it has been played before
                if (isPlaying && played) {
                    // 1. Set volume to 0.0 and play (it's silent)
                    music.volume = 0.0;
                    music.play().then(() => {
                        // 2. Then, Start Fade In (volume to 1.0)
                        startFade(1.0, FADE_TIME_MS);
                    }).catch(error => {
                        // console.log("Resuming music failed:", error);
                    });
                }
            }
        });
        
    </script>

</body>



</html>